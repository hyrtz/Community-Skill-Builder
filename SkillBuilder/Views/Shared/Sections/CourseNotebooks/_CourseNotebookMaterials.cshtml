@model SkillBuilder.Models.Course


@{
    // Current logged-in user ID
    var userId = User.FindFirst("UserId")?.Value;

    // Get user role
    var userRole = User.FindFirst(System.Security.Claims.ClaimTypes.Role)?.Value;

    // Check if current user is enrolled in this course or is the course owner or is admin
    bool canDownload = false;
    if (!string.IsNullOrEmpty(userId))
    {
        canDownload = Model.Artisan?.UserId == userId ||
                      Model.Enrollments.Any(e => e.UserId == userId) ||
                      userRole == "Admin";
    }
}

<style>
    .course-material-item {
        margin-top: 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        padding-left: 10px;
    }

    .course-material-title {
        font-size: 1.1rem;
        font-weight: bold;
        color: #333;
        margin-bottom: 0.3rem;
    }

    .course-material-description {
        font-size: 0.95rem;
        color: #555;
        margin-bottom: 0.5rem;
    }

    .course-material-size {
        font-size: 0.85rem;
        color: #777;
        margin-left: 0.3rem;
    }

    .download-icon {
        width: 32px;
        height: 32px;
        border: 2px solid #007bff;
        border-radius: 6px;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        transition: all 0.2s;
    }

        .download-icon:hover {
            background-color: #007bff;
        }

        .download-icon img {
            width: 18px;
            height: 18px;
            transition: all 0.2s;
        }

        .download-icon:hover img {
            filter: brightness(0) invert(1); /* turns the icon white on hover */
        }
</style>

@if (Model.Materials != null && Model.Materials.Count > 0)
{
    var materialIndex = 1;
    foreach (var material in Model.Materials)
    {
        <div class="course-material-item">
            <div>
                <div class="course-material-title">
                    Material @materialIndex: @material.Title
                    @if (material.FileSize > 0)
                    {
                        <span class="course-material-size">(@(material.FileSize / 1024) KB)</span>
                    }
                </div>

                @if (!string.IsNullOrWhiteSpace(material.Description))
                {
                    <div class="course-material-description">
                        @material.Description
                    </div>
                }
            </div>

            @if (!string.IsNullOrWhiteSpace(material.FilePath) && canDownload)
            {
                <a href="@material.FilePath" target="_blank" title="Download" class="download-icon">
                    <img src="~/assets/Icons/DownloadMaterials.ico" alt="Download" />
                </a>
            }
        </div>

        materialIndex++;
    }
}
else
{
    <p>No materials added yet for this course.</p>
}