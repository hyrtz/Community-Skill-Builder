@model List<SkillBuilder.Models.CourseProjectSubmission>

@{
    string TruncateText(string text)
    {
        if (string.IsNullOrWhiteSpace(text)) return "";
        return text.Length > 120 ? text.Substring(0, 120) + "..." : text;
    }
}

<style>
    /* === Approved Projects Section === */
    .approved-projects-section {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .approved-projects-grid {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    /* === Card Style === */
    .approved-project-card {
        display: flex;
        flex-direction: row;
        gap: 1rem;
        border: 1px solid #ddd;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        background: #fff;
        padding: 1rem;
        transition: transform 0.2s ease;
        width: 100%;
    }

        .approved-project-card:hover {
            transform: translateY(-2px);
        }

    .approved-project-img {
        width: 288px;
        height: 288px;
        object-fit: cover;
        border-radius: 10px;
        flex-shrink: 0;
        border: 3px solid #28A745;
    }

    .approved-project-content {
        display: flex;
        flex-direction: column;
        flex-grow: 1;
        max-width: 76%;
    }

    .approved-section {
        background-color: #f6fff8;
        border-radius: 10px;
        padding: 0.75rem 1rem;
        margin-bottom: 0.75rem;
        border-left: 4px solid #28A745;
    }

        .approved-section p {
            margin: 0.25rem 0;
            font-size: 0.9rem;
            color: #333;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .approved-section strong {
            color: #28A745;
            flex-shrink: 0;
        }

    /* Truncate text to one line */
    .truncate-text {
        display: -webkit-box;
        -webkit-line-clamp: 1;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: normal;
        max-width: 100%;
        flex: 1;
    }

    .approved-footer {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        margin-top: auto;
    }

    .btn-view-approved-project {
        background-color: #28A745;
        color: white;
        border: none;
        padding: 0.4rem 0.8rem;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s ease;
    }

        .btn-view-approved-project:hover {
            background-color: #1f8b39;
        }

    /* === Unique Modal Styles === */
    .approved-project-modal {
        display: none;
        position: fixed;
        z-index: 9999;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.7);
        justify-content: center;
        align-items: center;
    }

    .approved-project-modal-content {
        background: #fff;
        border-radius: 12px;
        max-width: 700px;
        width: 90%;
        padding: 1.5rem;
        position: relative;
        animation: fadeIn 0.3s ease-in-out;
        text-align: center;
    }

    .approved-project-modal-close {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 1.5rem;
        font-weight: bold;
        color: #333;
        cursor: pointer;
    }

    .approved-project-modal-details h2 {
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
        color: #28A745;
    }

    .approved-project-modal-details p {
        font-size: 1rem;
        color: #444;
        margin: 0.3rem 0;
    }

</style>

<section class="approved-projects-section">
    @if (Model != null && Model.Any())
    {
        <h2 style="font-weight: 300; font-size: 1rem;">
            Congratulations! Here's the list of project that has been approved. You can now access your certificate on the course page.
        </h2>

        <div class="approved-projects-grid">
            @foreach (var project in Model)
            {
                <div class="approved-project-card">
                    <img src="@project.MediaUrl" alt="@project.Course?.Title" class="approved-project-img" />

                    <div class="approved-project-content">
                        <!-- Course Info -->
                        <div class="approved-section">
                            <p><strong>Course:</strong> <span class="truncate-text">@project.Course?.Title</span></p>
                            <p>
                                <strong>Artisan:</strong> <span class="truncate-text">
                                    @(project.Course?.Artisan != null
                                                                ? project.Course.Artisan.FirstName + " " + project.Course.Artisan.LastName
                                                                : "Unknown Artisan")
                        </span>
                    </p>
                </div>

                        <!-- Final Project Info -->
                        <div class="approved-section">
                            <p><strong>Final Project Title:</strong> <span class="truncate-text">@project.Course?.FinalProjectTitle</span></p>
                            <p><strong>Final Project Description:</strong> <span class="truncate-text">@project.Course?.FinalProjectDescription</span></p>
                        </div>

                        <!-- User Submission -->
                        <div class="approved-section">
                            <p><strong>Your Submission:</strong></p>
                            <p><strong>Title:</strong> <span class="truncate-text">@project.Title</span></p>
                            <p><strong>Description:</strong> <span class="truncate-text">@project.Description</span></p>
                            <p><strong>Submitted At:</strong> <span class="truncate-text">@project.SubmittedAt.ToString("MMMM dd, yyyy")</span></p>
                            <p>
                                <strong>Approved Date:</strong> <span class="truncate-text">
                                    @project.ApprovedAt.ToString("MMMM dd, yyyy")
                                </span>
                            </p>
                        </div>

                        <div class="approved-footer">
                            <button type="button"
                                    class="btn-view-approved-project"
                                    data-title="@project.Title"
                                    data-description="@project.Description"
                                    data-media="@project.MediaUrl"
                                    data-finaltitle="@project.Course?.FinalProjectTitle"
                                    data-finaldesc="@project.Course?.FinalProjectDescription">
                                View Project
                            </button>
                        </div>
                    </div>
                </div>
                }
        </div>
    }
    else
    {
        <div class="user-projects-empty">
            You have no approved projects yet.<br />
            Once a project is approved, it will show up here.
        </div>
    }
</section>

<!-- === Unique Modal === -->
<div id="approvedProjectModal" class="approved-project-modal">
    <div class="approved-project-modal-content">
        <span class="approved-project-modal-close">&times;</span>
        <div class="approved-project-modal-details">

            <!-- 🟢 Final Project Info moved to the top -->
            <h4 id="approvedProjectModalFinalTitle" style="color:#28A745; margin-top:0;"></h4>
            <p id="approvedProjectModalFinalDesc" style="font-size:0.95rem; color:#555; margin-bottom:1rem;"></p>

            <hr style="margin: 1rem 0;" />

            <!-- 🖼️ Image and user submission details -->
            <img id="approvedProjectModalImage" style="max-width: 100%; max-height: 600px; border-radius: 8px; margin-bottom: 1rem;" alt="Project Image" />
            <h2 id="approvedProjectModalTitle"></h2>
            <p id="approvedProjectModalDescription"></p>

        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const approvedModal = document.getElementById("approvedProjectModal");
        const approvedModalTitle = document.getElementById("approvedProjectModalTitle");
        const approvedModalDescription = document.getElementById("approvedProjectModalDescription");
        const approvedModalImage = document.getElementById("approvedProjectModalImage");
        const approvedModalFinalTitle = document.getElementById("approvedProjectModalFinalTitle");
        const approvedModalFinalDesc = document.getElementById("approvedProjectModalFinalDesc");
        const approvedCloseBtn = document.querySelector(".approved-project-modal-close");

        document.querySelectorAll(".btn-view-approved-project").forEach(approvedBtn => {
            approvedBtn.addEventListener("click", () => {
                approvedModalTitle.textContent = "Project Title: " + approvedBtn.dataset.title || "Untitled Project";
                approvedModalDescription.textContent = "Caption: " + approvedBtn.dataset.description || "No description provided.";
                approvedModalImage.src = approvedBtn.dataset.media || "";
                approvedModalFinalTitle.textContent = "Final Project Title: " + approvedBtn.dataset.finaltitle || "";
                approvedModalFinalDesc.textContent = "Description: " + approvedBtn.dataset.finaldesc || "";
                approvedModal.style.display = "flex";
            });
        });

        approvedCloseBtn.addEventListener("click", () => approvedModal.style.display = "none");
        approvedModal.addEventListener("click", e => {
            if (e.target === approvedModal) approvedModal.style.display = "none";
        });
    });
</script>